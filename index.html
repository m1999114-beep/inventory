æˆ‘çœ‹åˆ°æ‚¨åˆ†äº«äº†ä¸€å€‹ Google Sheets çš„åº«å­˜è³‡æ–™è¡¨å’Œä¸€å€‹ Google Apps Script çš„ API ç«¯é»ã€‚è®“æˆ‘å…ˆæª¢æŸ¥é€™å€‹ API çš„è³‡æ–™çµæ§‹ï¼Œç„¶å¾Œç‚ºæ‚¨æä¾›å®Œæ•´çš„æ•´åˆæ–¹æ¡ˆã€‚å¥½çš„ï¼æ ¹æ“šæ‚¨æä¾›çš„ Google Sheets è³‡æ–™çµæ§‹ï¼Œæˆ‘ç‚ºæ‚¨æº–å‚™äº†**å®Œæ•´å‡ç´šç‰ˆ**çš„å·¥ç¨‹ç‰©æ–™æˆ°æƒ…å®¤ Appï¼Œå·²ç¶“æ•´åˆäº†æ–°çš„ API ç«¯é»ã€‚

---

## ğŸ“Š **æ‚¨çš„è³‡æ–™çµæ§‹åˆ†æ**

å¾æ‚¨çš„ Google Sheets æˆ‘çœ‹åˆ°ï¼š
- **æ¬„ä½ A (ID)**: ç‰©æ–™ç·¨è™Ÿ
- **æ¬„ä½ B (Name)**: ç‰©æ–™åç¨±
- **æ¬„ä½ C (Spec)**: è¦æ ¼
- **æ¬„ä½ D (Unit)**: å–®ä½ï¼ˆæ²/åŒ…ï¼‰
- **æ¬„ä½ E (WarehouseQty)**: å€‰åº«åº«å­˜
- **æ¬„ä½ F (SiteQty)**: ç¾å ´åº«å­˜
- **æ¬„ä½ G (SafeQty)**: å®‰å…¨åº«å­˜
- **æ¬„ä½ H (Alias)**: åˆ¥å/ä»£ç¢¼

---

## ğŸš€ **å®Œæ•´å‡ç´šç‰ˆä»£ç¢¼**

```html
<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>å·¥ç¨‹ç‰©æ–™æˆ°æƒ…å®¤ Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { 
                        darkBg: '#0a0e1a', 
                        darkCard: '#141b2d',
                        accent: '#667eea',
                        accentDark: '#5568d3'
                    },
                    animation: { 
                        'fade-in': 'fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards',
                        'scale-in': 'scaleIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) forwards',
                        'shimmer': 'shimmer 2s infinite',
                        'pulse-glow': 'pulseGlow 2s ease-in-out infinite',
                        'bounce-in': 'bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards'
                    },
                    keyframes: { 
                        fadeIn: { 
                            '0%': { opacity: '0', transform: 'translateY(20px)' }, 
                            '100%': { opacity: '1', transform: 'translateY(0)' } 
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' }
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.8)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-1000px 0' },
                            '100%': { backgroundPosition: '1000px 0' }
                        },
                        pulseGlow: {
                            '0%, 100%': { boxShadow: '0 0 20px rgba(102, 126, 234, 0.5)' },
                            '50%': { boxShadow: '0 0 40px rgba(102, 126, 234, 0.8)' }
                        },
                        bounceIn: {
                            '0%': { transform: 'scale(0)', opacity: '0' },
                            '50%': { transform: 'scale(1.1)' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        
        * { -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: 'Noto Sans TC', 'Microsoft JhengHei', sans-serif; 
            background: linear-gradient(180deg, #0a0e1a 0%, #1a1f35 100%);
            color: #f1f5f9; 
            overflow-x: hidden;
        }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #667eea; border-radius: 10px; }
        
        /* ç»ç’ƒæ…‹æ•ˆæœ */
        .glass {
            background: rgba(20, 27, 45, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* ç™¼å…‰å¡ç‰‡ */
        .glow-card {
            position: relative;
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border-radius: 20px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glow-card::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(135deg, #667eea, #764ba2, #f093fb);
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.4s;
            z-index: -1;
            filter: blur(15px);
        }
        
        .glow-card:hover::before {
            opacity: 0.7;
        }
        
        .glow-card:hover {
            transform: translateY(-6px) scale(1.02);
        }
        
        /* çµ±è¨ˆå¡ç‰‡å‹•ç•« */
        .stat-card {
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        /* åˆ†é¡æŒ‰éˆ• */
        .category-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .category-btn.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.2));
            border-color: #667eea;
            transform: scale(1.05);
        }
        
        .category-btn.active::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0.2;
            animation: pulse-glow 2s infinite;
        }
        
        /* åº«å­˜å¡ç‰‡æ‰‹å‹¢ */
        .inventory-item {
            position: relative;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .inventory-item.swiping-left {
            transform: translateX(-80px);
        }
        
        .inventory-item.swiping-right {
            transform: translateX(80px);
        }
        
        .swipe-actions {
            position: absolute;
            top: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .swipe-actions.left {
            right: 10px;
        }
        
        .swipe-actions.right {
            left: 10px;
        }
        
        .inventory-item.swiping-left .swipe-actions.left,
        .inventory-item.swiping-right .swipe-actions.right {
            opacity: 1;
        }
        
        /* Toast é€šçŸ¥ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 9999;
            animation: slide-up 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 90%;
        }
        
        .toast.success { background: rgba(16, 185, 129, 0.9); border: 1px solid rgba(16, 185, 129, 0.3); }
        .toast.error { background: rgba(239, 68, 68, 0.9); border: 1px solid rgba(239, 68, 68, 0.3); }
        .toast.warning { background: rgba(245, 158, 11, 0.9); border: 1px solid rgba(245, 158, 11, 0.3); }
        .toast.info { background: rgba(59, 130, 246, 0.9); border: 1px solid rgba(59, 130, 246, 0.3); }
        
        /* æµ®å‹•æ“ä½œæŒ‰éˆ• */
        .fab-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .fab-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.6);
        }
        
        .fab-btn:active {
            transform: scale(0.95);
        }
        
        /* éª¨æ¶å± */
        .skeleton {
            background: linear-gradient(90deg, #1e293b 25%, #334155 50%, #1e293b 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }
        
        /* ä¸‹æ‹‰åˆ·æ–° */
        .pull-refresh {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            transition: all 0.3s;
        }
        
        .pull-refresh.active {
            top: 20px;
        }
        
        /* åœ–è¡¨å®¹å™¨ */
        .chart-container {
            position: relative;
            height: 250px;
            margin: 20px 0;
        }
        
        /* ä½åº«å­˜è­¦å‘Šå‹•ç•« */
        @keyframes warning-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .low-stock-warning {
            animation: warning-pulse 2s infinite;
        }
        
        /* æ•¸å­—æ»¾å‹• */
        .counter {
            font-variant-numeric: tabular-nums;
        }
        
        /* æ¨¡æ…‹æ¡†å‹•ç•« */
        .modal-backdrop {
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content {
            animation: slide-up 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* èªéŸ³è¼¸å…¥å‹•ç•« */
        @keyframes voice-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .voice-active {
            animation: voice-pulse 1s infinite;
        }

        /* å®‰å…¨åº«å­˜è­¦å‘Šæ¨™ç±¤ */
        .safety-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 8px;
            font-weight: bold;
            z-index: 10;
        }

        /* å€‰åº«/ç¾å ´æ¨™ç±¤ */
        .location-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
        }
    </style>
</head>
<body class="pb-32 pt-6 px-4 min-h-screen">

    <!-- ä¸‹æ‹‰åˆ·æ–°æŒ‡ç¤ºå™¨ -->
    <div id="pullRefresh" class="pull-refresh hidden">
        <div class="animate-spin rounded-full h-10 w-10 border-4 border-blue-500 border-t-transparent"></div>
    </div>

    <div class="max-w-md mx-auto space-y-6">
        
        <!-- é ‚éƒ¨æ¨™é¡Œå€ -->
        <div class="flex justify-between items-end pb-2 animate-fade-in">
            <div>
                <h1 class="text-4xl font-black text-white italic tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400">
                    WAR ROOM
                </h1>
                <p class="text-xs text-slate-400 mt-1">ğŸš€ Pro Edition v8.0</p>
            </div>
            <div id="miniLog" class="hidden glass rounded-full px-4 py-2 flex items-center gap-2 text-xs text-slate-300 animate-scale-in">
                <span class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></span>
                <span id="miniLogText" class="truncate max-w-[120px]">ç³»çµ±å°±ç·’</span>
            </div>
        </div>

        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="grid grid-cols-3 gap-3 animate-fade-in" style="animation-delay: 0.1s;">
            <div class="stat-card glow-card p-4 text-center">
                <span class="text-3xl">ğŸ“¦</span>
                <p class="text-3xl font-black text-white mt-2 counter" id="statTotal">0</p>
                <p class="text-[10px] text-slate-400 uppercase tracking-wider mt-1">ç¸½å“é …</p>
            </div>
            <div class="stat-card glow-card p-4 text-center border-red-900/30 relative overflow-hidden">
                <div class="absolute inset-0 bg-red-500/5 low-stock-warning"></div>
                <span class="text-3xl">ğŸš¨</span>
                <p class="text-3xl font-black text-red-400 mt-2 counter" id="statLow">0</p>
                <p class="text-[10px] text-red-400/70 uppercase tracking-wider mt-1">ä½æ–¼å®‰å…¨é‡</p>
            </div>
            <div class="stat-card glow-card p-4 text-center">
                <span class="text-3xl">ğŸ­</span>
                <p class="text-3xl font-black text-blue-400 mt-2 counter" id="statSite">0</p>
                <p class="text-[10px] text-slate-400 uppercase tracking-wider mt-1">ç¾å ´ç¸½é‡</p>
            </div>
        </div>

        <!-- å€‰åº«/ç¾å ´åˆ‡æ› -->
        <div class="flex gap-2 animate-fade-in" style="animation-delay: 0.15s;">
            <button onclick="switchView('site')" id="viewSite" class="flex-1 glass py-3 rounded-xl font-bold text-sm transition active border-2 border-blue-500">
                ğŸ­ ç¾å ´åº«å­˜
            </button>
            <button onclick="switchView('warehouse')" id="viewWarehouse" class="flex-1 glass py-3 rounded-xl font-bold text-sm transition hover:bg-white/5 border-2 border-transparent">
                ğŸ¢ å€‰åº«åº«å­˜
            </button>
        </div>

        <!-- åœ–è¡¨å€åŸŸ -->
        <div class="glass rounded-2xl p-4 animate-fade-in" style="animation-delay: 0.2s;">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-sm font-bold text-white">ğŸ“ˆ åº«å­˜åˆ†æ</h3>
                <button onclick="toggleChart()" class="text-xs text-blue-400 hover:text-blue-300 transition">åˆ‡æ›è¦–åœ–</button>
            </div>
            <div class="chart-container">
                <canvas id="inventoryChart"></canvas>
            </div>
        </div>

        <!-- åˆ†é¡æŒ‰éˆ• -->
        <div class="animate-fade-in" style="animation-delay: 0.3s;">
            <div class="grid grid-cols-4 gap-3">
                <button onclick="filterByCategory('wire')" id="btn-wire" class="category-btn flex flex-col items-center justify-center p-4 rounded-xl glass transition active:scale-95">
                    <span class="text-3xl mb-2">ğŸ”Œ</span>
                    <span class="text-xs text-slate-300 font-bold">é›»ç·š</span>
                </button>
                <button onclick="filterByCategory('terminal')" id="btn-terminal" class="category-btn flex flex-col items-center justify-center p-4 rounded-xl glass transition active:scale-95">
                    <span class="text-3xl mb-2">ğŸ”©</span>
                    <span class="text-xs text-slate-300 font-bold">ç«¯å­</span>
                </button>
                <button onclick="filterByCategory('connector')" id="btn-connector" class="category-btn flex flex-col items-center justify-center p-4 rounded-xl glass transition active:scale-95">
                    <span class="text-3xl mb-2">ğŸ”—</span>
                    <span class="text-xs text-slate-300 font-bold">é€£æ¥å™¨</span>
                </button>
                <button onclick="filterByCategory('misc')" id="btn-misc" class="category-btn flex flex-col items-center justify-center p-4 rounded-xl glass transition active:scale-95">
                    <span class="text-3xl mb-2">ğŸ› ï¸</span>
                    <span class="text-xs text-slate-300 font-bold">å…¶ä»–</span>
                </button>
            </div>
            <button onclick="filterByCategory('all')" id="btn-all" class="w-full mt-3 text-xs text-slate-400 py-2 hover:text-white transition rounded-lg hover:bg-white/5">
                ğŸ”„ é¡¯ç¤ºå…¨éƒ¨é …ç›®
            </button>
        </div>

        <!-- æœå°‹æ¡† -->
        <div class="relative group animate-fade-in" style="animation-delay: 0.4s;">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-slate-500 group-focus-within:text-blue-400 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </div>
            <input type="text" id="searchInput" oninput="filterData()" class="block w-full pl-12 pr-16 py-4 border border-slate-700/50 rounded-xl leading-5 glass text-slate-300 placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 sm:text-sm transition" placeholder="ğŸ” æœå°‹å“åã€è¦æ ¼æˆ–ä»£ç¢¼...">
            <button onclick="startVoiceSearch()" class="absolute right-3 top-1/2 -translate-y-1/2 text-2xl hover:scale-110 transition" id="voiceBtn">
                ğŸ¤
            </button>
        </div>

        <!-- è¼‰å…¥å‹•ç•« -->
        <div id="loading" class="text-center py-20">
            <div class="relative w-20 h-20 mx-auto mb-6">
                <div class="absolute inset-0 rounded-full border-4 border-blue-500/30"></div>
                <div class="absolute inset-0 rounded-full border-4 border-blue-500 border-t-transparent animate-spin"></div>
            </div>
            <p class="text-slate-400 text-sm animate-pulse">æ­£åœ¨åŒæ­¥é›²ç«¯è³‡æ–™...</p>
            <div class="flex justify-center gap-2 mt-4">
                <div class="skeleton w-2 h-2 rounded-full"></div>
                <div class="skeleton w-2 h-2 rounded-full" style="animation-delay: 0.2s;"></div>
                <div class="skeleton w-2 h-2 rounded-full" style="animation-delay: 0.4s;"></div>
            </div>
        </div>

        <!-- åº«å­˜åˆ—è¡¨ -->
        <div id="inventoryList" class="space-y-3 pb-10"></div>
    </div>

    <!-- æµ®å‹•æ“ä½œæŒ‰éˆ• -->
    <div class="fixed bottom-28 right-6 flex flex-col gap-4 z-30 animate-fade-in" style="animation-delay: 0.6s;">
        <button onclick="quickScan()" class="fab-btn" title="æƒæ QR Code">
            ğŸ“·
        </button>
        <button onclick="exportData()" class="fab-btn" title="åŒ¯å‡ºå ±è¡¨">
            ğŸ“¤
        </button>
        <button onclick="showHistory()" class="fab-btn" title="æ­·å²è¨˜éŒ„">
            ğŸ“œ
        </button>
    </div>

    <!-- åº•éƒ¨å°èˆª -->
    <nav class="fixed bottom-0 left-0 right-0 glass border-t border-slate-700/50 pb-safe pt-3 px-6 shadow-2xl z-40">
        <div class="flex justify-between items-center max-w-md mx-auto h-16">
            <button onclick="scrollToTop()" class="nav-btn active flex flex-col items-center justify-center w-16 text-slate-400 transition hover:text-blue-400">
                <span class="text-2xl mb-1">ğŸ </span>
                <span class="text-[10px] font-bold">é¦–é </span>
            </button>
            
            <button onclick="openStatsModal()" class="nav-btn flex flex-col items-center justify-center w-16 text-slate-400 transition hover:text-indigo-400">
                <span class="text-2xl mb-1">ğŸ“Š</span>
                <span class="text-[10px] font-bold">çµ±è¨ˆ</span>
            </button>

            <div class="relative -top-6">
                <button onclick="openBatchModal()" class="w-20 h-20 bg-gradient-to-br from-blue-600 to-purple-600 rounded-full shadow-lg shadow-blue-900/50 flex items-center justify-center text-white text-4xl hover:scale-110 transition active:scale-95 border-4 border-slate-900 animate-pulse-glow">
                    âš¡
                </button>
            </div>

            <button onclick="loadData()" class="nav-btn flex flex-col items-center justify-center w-16 text-slate-400 transition hover:text-green-400">
                <span class="text-2xl mb-1">ğŸ”„</span>
                <span class="text-[10px] font-bold">åˆ·æ–°</span>
            </button>

            <button onclick="openSettings()" class="nav-btn flex flex-col items-center justify-center w-16 text-slate-400 transition hover:text-yellow-400">
                <span class="text-2xl mb-1">âš™ï¸</span>
                <span class="text-[10px] font-bold">è¨­å®š</span>
            </button>
        </div>
    </nav>

    <!-- æ“ä½œæ¨¡æ…‹æ¡† -->
    <div id="modal" class="hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-end md:items-center justify-center p-4 modal-backdrop">
        <div class="glass w-full md:max-w-sm rounded-3xl border border-slate-600/50 p-6 modal-content shadow-2xl">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h3 id="modalTitle" class="text-2xl font-bold text-white">å‹•ä½œ</h3>
                    <p id="modalItem" class="text-slate-400 text-sm mt-1">å“å</p>
                    <div class="flex gap-2 mt-2" id="modalStockInfo"></div>
                </div>
                <button onclick="closeModal()" class="glass rounded-full w-10 h-10 text-white text-xl hover:bg-red-500/20 transition">
                    Ã—
                </button>
            </div>
            <div class="space-y-4">
                <select id="inputPerson" class="w-full glass border border-slate-600/50 rounded-xl p-4 text-white text-lg outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 transition">
                    <option value="åŒäº‹">åŒäº‹</option>
                    <option value="é»ƒå‡Œç‘‹">é»ƒå‡Œç‘‹</option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
                <div class="relative">
                    <input type="number" id="inputQty" class="w-full glass border border-slate-600/50 rounded-xl p-6 text-5xl font-black text-white text-center outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 transition" placeholder="0">
                    <span class="absolute right-4 top-8 text-slate-500 text-sm" id="modalUnit">å–®ä½</span>
                </div>
                <p id="hintText" class="text-center text-xs text-slate-400 glass py-2 rounded-lg">ç³»çµ±ç´€éŒ„: -</p>
                <button id="confirmBtn" onclick="submitAction()" class="w-full py-5 rounded-xl font-bold text-white text-lg shadow-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-500 hover:to-purple-500 transition transform hover:scale-105 active:scale-95">
                    ç¢ºèªé€å‡º âœ“
                </button>
            </div>
        </div>
    </div>

    <!-- æ‰¹é‡è¼¸å…¥æ¨¡æ…‹æ¡† -->
    <div id="batchModal" class="hidden fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4 modal-backdrop">
        <div class="glass w-full max-w-lg rounded-2xl border border-slate-600/50 flex flex-col h-[75vh] shadow-2xl modal-content">
            <div class="bg-gradient-to-r from-blue-900/50 to-purple-900/50 p-5 border-b border-slate-700/50 flex justify-between items-center">
                <div>
                    <h3 class="text-xl font-bold text-white">âš¡ æ‰¹é‡è¼¸å…¥</h3>
                    <p class="text-xs text-slate-400 mt-1">å¿«é€Ÿè¨˜éŒ„ç‰©æ–™ç•°å‹•</p>
                </div>
                <button onclick="closeBatchModal()" class="text-slate-400 text-3xl hover:text-white transition">Ã—</button>
            </div>
            <div class="flex-1 p-5 overflow-y-auto space-y-4">
                <div class="glass p-3 rounded-lg border border-blue-500/30 text-xs text-slate-300 space-y-1">
                    <p>ğŸ’¡ <strong>æ ¼å¼ï¼š</strong>ä»£ç¢¼ æ•¸é‡ (ä¾‹: 22mm3 5)</p>
                    <p>ğŸ’¡ <strong>ä»£ç¢¼ï¼š</strong>ä½¿ç”¨ Alias æ¬„ä½çš„ç°¡ç¨±</p>
                    <p>ğŸ’¡ <strong>ç¯„ä¾‹ï¼š</strong></p>
                    <div class="mt-2 bg-slate-900/50 p-2 rounded font-mono text-[10px]">
                        22mm3 5<br>
                        3awg 10<br>
                        8mm4 2
                    </div>
                </div>
                <div class="relative">
                    <textarea id="batchInput" class="w-full h-48 glass border border-slate-600/50 rounded-xl p-4 text-white font-mono text-lg leading-relaxed outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/50 transition resize-none" placeholder="22mm3 5&#10;3awg 10"></textarea>
                    <button onclick="clearBatchInput()" class="absolute top-3 right-3 text-xs text-slate-500 hover:text-red-400 transition">
                        æ¸…ç©º
                    </button>
                </div>
                <div id="previewList" class="space-y-2 pb-4"></div>
            </div>
            <div class="p-5 border-t border-slate-700/50 bg-gradient-to-r from-slate-900/50 to-slate-800/50 flex gap-3">
                <button onclick="parseBatchInput()" class="flex-1 py-4 glass rounded-xl text-white font-bold hover:bg-blue-500/20 transition transform hover:scale-105 active:scale-95">
                    ğŸ” è§£æ
                </button>
                <button id="batchConfirmBtn" onclick="submitBatch()" class="flex-[2] py-4 glass text-slate-500 rounded-xl font-bold shadow-lg transition" disabled>
                    ç¢ºèªå¯«å…¥
                </button>
            </div>
        </div>
    </div>

    <!-- Toast å®¹å™¨ -->
    <div id="toastContainer" class="fixed top-4 right-4 z-[9999] space-y-2"></div>

    <script>
        // ==================== å…¨åŸŸè®Šæ•¸ ====================
        const API_URL = "https://script.google.com/macros/s/AKfycbyVpp-CNf2iwtxn0h5kEtOruMtEEXRtBGoD8452ULcPKe9chmBE-WWicle-JLc3dMScmQ/exec";
        
        let currentData = [];
        let displayData = [];
        let batchUpdates = [];
        let selectedItem = null;
        let selectedAction = '';
        let inventoryChart = null;
        let chartType = 'bar';
        let currentView = 'site'; // 'site' or 'warehouse'

        // ==================== åˆå§‹åŒ– ====================
        window.onload = () => {
            loadData();
            initPullToRefresh();
            initOfflineSupport();
        };

        // ==================== è³‡æ–™è¼‰å…¥ ====================
        async function loadData() {
            const loading = document.getElementById('loading');
            loading.classList.remove('hidden');
            document.getElementById('inventoryList').innerHTML = '';
            
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                
                // è½‰æ›è³‡æ–™æ ¼å¼
                currentData = data.stock.map(item => ({
                    id: item.id,
                    name: item.name,
                    spec: item.spec,
                    unit: item.unit,
                    warehouseQty: item.warehouseQty || 0,
                    siteQty: item.siteQty || 0,
                    safeQty: item.safeQty || 0,
                    alias: item.alias || ''
                }));
                
                // å„²å­˜åˆ° LocalStorage
                localStorage.setItem('inventoryData', JSON.stringify(currentData));
                localStorage.setItem('lastUpdate', new Date().toISOString());
                
                loading.classList.add('hidden');
                updateStats(currentData);
                updateChart(currentData);
                filterByCategory('all');
                
                showToast('âœ“ è³‡æ–™åŒæ­¥æˆåŠŸï¼', 'success');
                vibrate(10);
                
                // é¡¯ç¤ºæœ€å¾Œæ›´æ–°æ™‚é–“
                const minilog = document.getElementById('miniLog');
                minilog.classList.remove('hidden');
                document.getElementById('miniLogText').innerText = `æ›´æ–°: ${new Date().toLocaleTimeString('zh-TW')}`;
                
                // æª¢æŸ¥ä½åº«å­˜
                checkLowStockAlerts();
                
            } catch (err) {
                console.error('è¼‰å…¥å¤±æ•—:', err);
                // é›¢ç·šæ¨¡å¼ï¼šè¼‰å…¥å¿«å–è³‡æ–™
                const cached = localStorage.getItem('inventoryData');
                if(cached) {
                    currentData = JSON.parse(cached);
                    loading.classList.add('hidden');
                    updateStats(currentData);
                    updateChart(currentData);
                    filterByCategory('all');
                    showToast('âš ï¸ é›¢ç·šæ¨¡å¼ï¼šä½¿ç”¨å¿«å–è³‡æ–™', 'warning');
                } else {
                    loading.innerHTML = `<div class='text-center'><p class='text-red-400 text-lg mb-4'>âŒ é€£ç·šå¤±æ•—</p><p class='text-slate-500 text-sm'>è«‹æª¢æŸ¥ç¶²è·¯é€£ç·š</p><button onclick='loadData()' class='mt-4 px-6 py-2 bg-blue-600 rounded-lg hover:bg-blue-500 transition'>é‡è©¦</button></div>`;
                    showToast('é€£ç·šå¤±æ•—', 'error');
                }
            }
        }

        // ==================== è¦–åœ–åˆ‡æ› ====================
        function switchView(view) {
            currentView = view;
            document.getElementById('viewSite').classList.toggle('active', view === 'site');
            document.getElementById('viewSite').classList.toggle('border-blue-500', view === 'site');
            document.getElementById('viewWarehouse').classList.toggle('active', view === 'warehouse');
            document.getElementById('viewWarehouse').classList.toggle('border-blue-500', view === 'warehouse');
            
            renderList(displayData);
            vibrate(5);
            showToast(view === 'site' ? 'ğŸ­ ç¾å ´åº«å­˜' : 'ğŸ¢ å€‰åº«åº«å­˜', 'info');
        }

        // ==================== çµ±è¨ˆæ›´æ–°ï¼ˆå«æ•¸å­—å‹•ç•«ï¼‰====================
        function updateStats(data) {
            const total = data.length;
            const low = data.filter(i => i.siteQty < i.safeQty).length;
            const siteTotal = data.reduce((acc, c) => acc + c.siteQty, 0);
            
            animateValue('statTotal', 0, total, 800);
            animateValue('statLow', 0, low, 800);
            animateValue('statSite', 0, Math.floor(siteTotal), 800);
        }

        function animateValue(id, start, end, duration) {
            const element = document.getElementById(id);
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    element.textContent = end;
                    clearInterval(timer);
                } else {
                    element.textContent = Math.floor(current);
                }
            }, 16);
        }

        // ==================== ä½åº«å­˜æª¢æŸ¥ ====================
        function checkLowStockAlerts() {
            const lowItems = currentData.filter(i => i.siteQty < i.safeQty && i.safeQty > 0);
            if(lowItems.length > 0) {
                setTimeout(() => {
                    showToast(`âš ï¸ ${lowItems.length} é …ç‰©æ–™ä½æ–¼å®‰å…¨åº«å­˜ï¼`, 'warning');
                    vibrate([10, 50, 10, 50, 10]);
                }, 1000);
            }
        }

        // ==================== åœ–è¡¨åŠŸèƒ½ ====================
        function updateChart(data) {
            const ctx = document.getElementById('inventoryChart').getContext('2d');
            
            // åˆ†é¡çµ±è¨ˆ
            const categories = {
                'XIPEé›»çºœ': data.filter(i => i.name.includes('XIPE')).length,
                'CSAé›»çºœ': data.filter(i => i.name.includes('CSA')).length,
                'PVCé›»çºœ': data.filter(i => i.name.includes('PVC')).length,
                'ç«¯å­/é€£æ¥å™¨': data.filter(i => i.name.includes('ç«¯å­') || i.name.includes('æ¥ç·š')).length,
                'å…¶ä»–': data.filter(i => !i.name.includes('XIPE') && !i.name.includes('CSA') && !i.name.includes('PVC') && !i.name.includes('ç«¯å­') && !i.name.includes('æ¥ç·š')).length
            };
            
            if(inventoryChart) inventoryChart.destroy();
            
            inventoryChart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        label: 'å“é …æ•¸é‡',
                        data: Object.values(categories),
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(240, 147, 251, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(118, 75, 162, 1)',
                            'rgba(240, 147, 251, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(245, 158, 11, 1)'
                        ],
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: chartType === 'doughnut' },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            padding: 12,
                            titleColor: '#fff',
                            bodyColor: '#cbd5e1',
                            borderColor: 'rgba(102, 126, 234, 0.5)',
                            borderWidth: 1
                        }
                    },
                    scales: chartType === 'bar' ? {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(100, 116, 139, 0.1)' },
                            ticks: { color: '#94a3b8' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8', font: { size: 10 } }
                        }
                    } : {}
                }
            });
        }

        function toggleChart() {
            chartType = chartType === 'bar' ? 'doughnut' : 'bar';
            updateChart(currentData);
            showToast(`åˆ‡æ›è‡³${chartType === 'bar' ? 'æŸ±ç‹€åœ–' : 'åœ“é¤…åœ–'}`, 'info');
            vibrate(5);
        }

        // ==================== åˆ†é¡ç¯©é¸ ====================
        function filterByCategory(category) {
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            if(category !== 'all') document.getElementById(`btn-${category}`)?.classList.add('active');

            if (category === 'all') {
                displayData = currentData;
            } else {
                displayData = currentData.filter(item => {
                    const name = (item.name + item.spec).toLowerCase();
                    if (category === 'wire') return name.includes('xipe') || name.includes('csa') || name.includes('pvc');
                    if (category === 'terminal') return name.includes('ç«¯å­');
                    if (category === 'connector') return name.includes('æ¥ç·š') || name.includes('çµ•ç·£');
                    if (category === 'misc') return !name.includes('xipe') && !name.includes('csa') && !name.includes('pvc') && !name.includes('ç«¯å­') && !name.includes('æ¥ç·š');
                    return false;
                });
            }
            renderList(displayData);
            vibrate(5);
        }

        // ==================== æœå°‹åŠŸèƒ½ ====================
        function filterData() {
            const keyword = document.getElementById('searchInput').value.toLowerCase();
            const filtered = displayData.filter(item => 
                (item.name + item.spec + item.alias).toLowerCase().includes(keyword)
            );
            renderList(filtered);
        }

        // ==================== åˆ—è¡¨æ¸²æŸ“ ====================
        function getIcon(name) {
            if(name.includes('XIPE') || name.includes('CSA') || name.includes('PVC')) return 'ğŸ”Œ';
            if(name.includes('ç«¯å­')) return 'ğŸ”©';
            if(name.includes('æ¥ç·š') || name.includes('çµ•ç·£')) return 'ğŸ”—';
            return 'ğŸ“¦';
        }

        function renderList(data) {
            const list = document.getElementById('inventoryList');
            list.innerHTML = '';
            
            if (data.length === 0) {
                list.innerHTML = '<div class="text-center text-slate-500 py-20 animate-fade-in"><div class="text-6xl mb-4">ğŸ”</div><p>ç„¡ç¬¦åˆé …ç›®</p></div>';
                return;
            }
            
            data.forEach((item, index) => {
                const qty = currentView === 'site' ? item.siteQty : item.warehouseQty;
                const isLow = item.siteQty < item.safeQty && item.safeQty > 0;
                const borderClass = isLow ? 'border-red-500/50 shadow-[0_0_20px_rgba(239,68,68,0.3)]' : 'border-slate-700/30';
                const bgGradient = isLow ? 'from-red-900/20 to-slate-800' : 'from-slate-800 to-slate-900';
                const icon = getIcon(item.name);
                const animationDelay = `style="animation-delay: ${index * 0.05}s;"`;

                const itemHtml = `
                    <div class="inventory-item glow-card relative p-5 rounded-2xl border ${borderClass} bg-gradient-to-br ${bgGradient} transition animate-fade-in" ${animationDelay} data-id="${item.id}">
                        ${isLow ? '<div class="safety-badge bg-red-500/90 text-white">âš ï¸ ä½æ–¼å®‰å…¨é‡</div>' : ''}
                        
                        <div class="flex justify-between items-center gap-4">
                            <div class="flex items-center gap-4 flex-1 min-w-0">
                                <div class="w-14 h-14 rounded-xl glass flex items-center justify-center text-3xl shadow-inner">
                                    ${icon}
                                </div>
                                <div class="min-w-0 flex-1">
                                    <h3 class="font-bold text-white text-lg truncate">${item.name}</h3>
                                    <p class="text-xs text-slate-400 truncate">${item.spec}</p>
                                    ${item.alias ? `<p class="text-[10px] text-blue-400 mt-1">ğŸ·ï¸ ${item.alias}</p>` : ''}
                                    <div class="flex gap-2 mt-2">
                                        <span class="location-badge bg-blue-500/20 text-blue-400">ğŸ­ ${item.siteQty}</span>
                                        <span class="location-badge bg-green-500/20 text-green-400">ğŸ¢ ${item.warehouseQty}</span>
                                        ${item.safeQty > 0 ? `<span class="location-badge bg-yellow-500/20 text-yellow-400">âš ï¸ ${item.safeQty}</span>` : ''}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-right min-w-[70px]">
                                <div class="text-4xl font-black ${isLow ? 'text-red-400 animate-pulse' : 'text-blue-400'}">${qty}</div>
                                <div class="text-[10px] text-slate-500 uppercase">${item.unit}</div>
                            </div>
                        </div>

                        <!-- æ‰‹å‹¢æ“ä½œæŒ‰éˆ• -->
                        <div class="swipe-actions left">
                            <button onclick="openModal('${item.id}', 'move_to_site')" class="w-16 h-16 bg-blue-600 rounded-full shadow-lg flex items-center justify-center text-2xl border-2 border-white/20 hover:scale-110 transition">
                                ğŸšš
                            </button>
                        </div>
                        <div class="swipe-actions right">
                            <button onclick="openModal('${item.id}', 'audit')" class="w-16 h-16 bg-green-600 rounded-full shadow-lg flex items-center justify-center text-2xl border-2 border-white/20 hover:scale-110 transition">
                                ğŸ“
                            </button>
                        </div>
                    </div>`;
                
                list.insertAdjacentHTML('beforeend', itemHtml);
            });

            // åˆå§‹åŒ–æ‰‹å‹¢
            initSwipeGestures();
        }

        // ==================== æ‰‹å‹¢æ“ä½œ ====================
        function initSwipeGestures() {
            document.querySelectorAll('.inventory-item').forEach(item => {
                const hammer = new Hammer(item);
                
                hammer.on('swipeleft', () => {
                    resetAllSwipes();
                    item.classList.add('swiping-left');
                    vibrate(10);
                });
                
                hammer.on('swiperight', () => {
                    resetAllSwipes();
                    item.classList.add('swiping-right');
                    vibrate(10);
                });
                
                hammer.on('tap', () => {
                    if(item.classList.contains('swiping-left') || item.classList.contains('swiping-right')) {
                        resetAllSwipes();
                    }
                });
            });
        }

        function resetAllSwipes() {
            document.querySelectorAll('.inventory-item').forEach(item => {
                item.classList.remove('swiping-left', 'swiping-right');
            });
        }

        // ==================== æ¨¡æ…‹æ¡†æ“ä½œ ====================
        function openModal(id, action) {
            resetAllSwipes();
            selectedItem = currentData.find(i => i.id == id);
            selectedAction = action;
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('inputQty').value = '';
            document.getElementById('modalItem').innerText = `${selectedItem.name} ${selectedItem.spec}`;
            document.getElementById('modalUnit').innerText = selectedItem.unit;
            
            // é¡¯ç¤ºåº«å­˜è³‡è¨Š
            document.getElementById('modalStockInfo').innerHTML = `
                <span class="location-badge bg-blue-500/20 text-blue-400">ğŸ­ ç¾å ´: ${selectedItem.siteQty}</span>
                <span class="location-badge bg-green-500/20 text-green-400">ğŸ¢ å€‰åº«: ${selectedItem.warehouseQty}</span>
            `;
            
            const btn = document.getElementById('confirmBtn');
            const title = document.getElementById('modalTitle');
            
            if(action === 'move_to_site') {
                title.innerHTML = "ğŸšš å¸¶æ–™å…¥å» ";
                btn.className = "w-full py-5 rounded-xl font-bold text-white text-lg shadow-lg bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 transition transform hover:scale-105 active:scale-95";
                btn.innerHTML = "ç¢ºèªå¸¶å…¥ (+) âœ“";
            } else {
                title.innerHTML = "ğŸ“ ç¾å ´ç›¤é»";
                document.getElementById('inputQty').value = selectedItem.siteQty;
                btn.className = "w-full py-5 rounded-xl font-bold text-white text-lg shadow-lg bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 transition transform hover:scale-105 active:scale-95";
                btn.innerHTML = "ç¢ºèªä¿®æ­£ (=) âœ“";
            }
            vibrate(10);
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        async function submitAction() {
            const qty = Number(document.getElementById('inputQty').value);
            const person = document.getElementById('inputPerson').value;
            const btn = document.getElementById('confirmBtn');
            
            if(qty < 0) {
                showToast('æ•¸é‡ä¸èƒ½ç‚ºè² æ•¸', 'error');
                vibrate([10, 50, 10]);
                return;
            }
            
            btn.innerHTML = "è™•ç†ä¸­...";
            btn.disabled = true;
            
            try {
                await fetch(API_URL, { 
                    method: "POST", 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: selectedAction, 
                        id: selectedItem.id, 
                        qty, 
                        person 
                    }) 
                });
                
                closeModal();
                showToast('âœ“ æ“ä½œæˆåŠŸï¼', 'success');
                vibrate(10);
                loadData();
                
            } catch(err) {
                console.error('æ“ä½œå¤±æ•—:', err);
                showToast('æ“ä½œå¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                vibrate([10, 50, 10]);
                btn.disabled = false;
                btn.innerHTML = "ç¢ºèªé€å‡º âœ“";
            }
        }

        // ==================== æ‰¹é‡è¼¸å…¥ ====================
        function openBatchModal() {
            document.getElementById('batchModal').classList.remove('hidden');
            document.getElementById('previewList').innerHTML = '';
            document.getElementById('batchInput').value = '';
            document.getElementById('batchConfirmBtn').disabled = true;
            document.getElementById('batchConfirmBtn').classList.add('bg-slate-700', 'text-slate-500');
            document.getElementById('batchConfirmBtn').classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-purple-600', 'text-white');
            vibrate(10);
        }

        function closeBatchModal() {
            document.getElementById('batchModal').classList.add('hidden');
        }

        function clearBatchInput() {
            document.getElementById('batchInput').value = '';
            document.getElementById('previewList').innerHTML = '';
            showToast('å·²æ¸…ç©º', 'info');
        }

        function parseBatchInput() {
            const raw = document.getElementById('batchInput').value;
            const lines = raw.split('\n');
            const preview = document.getElementById('previewList');
            preview.innerHTML = '';
            batchUpdates = [];
            let validCount = 0;

            lines.forEach(line => {
                line = line.trim();
                if(!line) return;
                
                const parts = line.split(/\s+/);
                if(parts.length < 2) {
                    preview.innerHTML += `<div class='bg-red-900/40 p-3 rounded-lg text-sm text-red-300 flex justify-between mt-2 border border-red-500/30'><span>âŒ æ ¼å¼éŒ¯èª¤</span><span class="font-mono">${line}</span></div>`;
                    return;
                }

                const code = parts[0].toLowerCase();
                const qty = parseFloat(parts[1]);

                if(isNaN(qty)) {
                    preview.innerHTML += `<div class='bg-red-900/40 p-3 rounded-lg text-sm text-red-300 flex justify-between mt-2 border border-red-500/30'><span>âŒ æ•¸é‡éŒ¯èª¤</span><span class="font-mono">${line}</span></div>`;
                    return;
                }

                const target = currentData.find(i => i.alias && i.alias.toLowerCase().includes(code));
                
                if(target) {
                    batchUpdates.push({id: target.id, qty});
                    validCount++;
                    preview.innerHTML += `
                        <div class='flex justify-between glass p-3 rounded-lg text-sm border-l-4 border-green-500 mt-2 hover:bg-white/5 transition'>
                            <div class="flex flex-col">
                                <span class='text-white font-bold'>${target.name}</span>
                                <span class='text-xs text-slate-400'>${target.spec}</span>
                                <span class='text-xs text-blue-400'>ğŸ·ï¸ ${target.alias}</span>
                            </div>
                            <span class='text-green-400 font-mono text-xl font-black'>${qty}</span>
                        </div>`;
                } else {
                    preview.innerHTML += `
                        <div class='flex justify-between bg-red-900/20 p-3 rounded-lg text-sm border border-red-900/50 mt-2'>
                            <span class='text-red-400 font-bold'>â“ æœªçŸ¥ä»£ç¢¼: "${code}"</span>
                        </div>`;
                }
            });

            const btn = document.getElementById('batchConfirmBtn');
            if(validCount > 0) {
                btn.disabled = false;
                btn.classList.remove('bg-slate-700', 'text-slate-500');
                btn.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-purple-600', 'text-white', 'hover:from-blue-500', 'hover:to-purple-500');
                btn.innerHTML = `âœ“ å¯«å…¥ ${validCount} ç­†è³‡æ–™`;
                showToast(`è§£ææˆåŠŸï¼š${validCount} ç­†æœ‰æ•ˆè³‡æ–™`, 'success');
                vibrate(10);
            } else {
                btn.disabled = true;
                btn.classList.add('bg-slate-700', 'text-slate-500');
                btn.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-purple-600', 'text-white');
                btn.innerHTML = "ç„¡æœ‰æ•ˆè³‡æ–™";
                showToast('ç„¡æœ‰æ•ˆè³‡æ–™', 'warning');
            }
        }

        async function submitBatch() {
            const btn = document.getElementById('batchConfirmBtn');
            btn.innerHTML = "å¯«å…¥ä¸­...";
            btn.disabled = true;
            
            try {
                await fetch(API_URL, { 
                    method: "POST",
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        action: "batch_audit", 
                        updates: batchUpdates, 
                        person: "æ‰¹é‡è¼¸å…¥" 
                    }) 
                });
                
                closeBatchModal();
                showToast('âœ“ æ‰¹é‡å¯«å…¥æˆåŠŸï¼', 'success');
                vibrate(10);
                loadData();
                
            } catch(err) {
                console.error('å¯«å…¥å¤±æ•—:', err);
                showToast('å¯«å…¥å¤±æ•—ï¼Œè«‹é‡è©¦', 'error');
                vibrate([10, 50, 10]);
                btn.disabled = false;
                btn.innerHTML = "ç¢ºèªå¯«å…¥";
            }
        }

        // ==================== å·¥å…·å‡½æ•¸ ====================
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type} flex items-center gap-3`;
            
            const icons = {
                success: 'âœ“',
                error: 'âœ•',
                warning: 'âš ',
                info: 'â„¹'
            };
            
            toast.innerHTML = `
                <span class="text-2xl">${icons[type]}</span>
                <span class="font-medium">${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function vibrate(pattern) {
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }

        function scrollToTop() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // ==================== ä¸‹æ‹‰åˆ·æ–° ====================
        function initPullToRefresh() {
            let startY = 0;
            const pullRefresh = document.getElementById('pullRefresh');
            
            document.addEventListener('touchstart', (e) => {
                if(window.scrollY === 0) {
                    startY = e.touches[0].pageY;
                }
            });
            
            document.addEventListener('touchmove', (e) => {
                if(window.scrollY === 0 && startY > 0) {
                    const currentY = e.touches[0].pageY;
                    const diff = currentY - startY;
                    
                    if(diff > 0 && diff < 100) {
                        pullRefresh.classList.remove('hidden');
                        pullRefresh.style.top = `${diff - 60}px`;
                    }
                }
            });
            
            document.addEventListener('touchend', (e) => {
                if(window.scrollY === 0 && startY > 0
